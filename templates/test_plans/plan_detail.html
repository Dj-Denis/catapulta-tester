{% extends "base.html" %}
{% load i18n %}
{% block content %}

    <div class="section section--hero">
        <div class="section__content">
            <div class="container-fludi container-wide">
                <div class="card">
                    <article class="card-body">
                        <div class="text-center"><h2 class="section__title">Тест план</h2></div>
                        <div class="row">
                            <div class="col-7">
                                <h4 class="plan__title">{{ plan.name }}</h4>
                            </div>
                            <div class="col-5 text-right">
                                <a class="btn btn-info" href={% url "plan_edit" plan.pk %}> {% trans "Редактировать" %}</a>
                                <a class="btn btn-primary" href="{% url "plan_run" %}?plan_id={{ plan.pk }}">{% trans "Запустить план" %}</a>
                                <a class="btn btn-warning" href={% url 'plan_list' %}> {% trans "Вернутся в список" %}</a>
                                <a  class="btn btn-danger" href={% url 'plan_delete' plan.pk %}>{% trans "Удалить" %}</a>
{#                                <a class="btn btn-success" href="{% url 'plan_csv' plan.pk %}">Експорт в CSV</a>#}
                            </div>
                        </div>
                        <div class="plan__decription">
                            {{ plan.description }}
                        </div>
                        <h2 class="planDetail__title mt-2">{% trans "Детали тест плана" %}</h2>
                        <div class="planDetail__table">
                            <table class="table table-lg table-hover border justify-content-center">
                                <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">{% trans "Название тест кейса" %}</th>
                                    <th scope="col">{% trans "Дата последнего запуска" %}</th>
                                    <th scope="col">{% trans "Запустил" %}</th>
                                    <th scope="col">{% trans "Статут запуска" %}</th>
                                    <th scope="col">{% trans "Коментарий" %}</th>
                                </tr>
                                </thead>
                                <tbody>
                                    {% for case_log in plan.last_log.caselog_set.all %}
                                    <tr>
                                        <td>{{ case_log.case.id }}</td>
                                        <td><a class="text-dark" href={% url 'case_detail' case_log.case.pk %}>{{ case_log.case.name }}</a></td>
                                        <td>{{ case_log.case.last_log.date|default:_("Не запускалось") }}</td>
                                        <td>{{ case_log.run_by }}</td>
                                        {%  if case_log.status == "0" %}
                                            <td class="text-center bg-danger text-light rounded">{{ case_log.get_status_display }}</td>
                                        {% elif case_log.status == "1" %}
                                            <td class="text-center bg-success text-light rounded">{{ case_log.get_status_display }}</td>
                                        {% else %}
                                            <td class="text-center bg-secondary text-light rounded">{{ case_log.get_status_display }}</td>
                                        {% endif %}
                                        <td>{{ case_log.case.comment }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <h2 class="planLog__title">{% trans "Лог тест плана" %}</h2>
                        <div class="planLog__table">
                            <table class="table table-lg table-hover border">
                                <thead>
                                <tr>
                                    <th scope="col">{% trans "Дата последнего запуска" %}</th>
                                    <th scope="col">{% trans "Запустил" %}</th>
                                    <th scope="col">{% trans "Статус запуска" %}</th>
                                    <th scope="col">{% trans "Коментарий" %}</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for log in logs %}
                                    <tr>
                                    <td>{{ log.last_run }}</td>
                                    <td>{{ log.plan.create_by }}</td>
                                        {%  if log.status == "0" %}
                                            <td class="text-center bg-danger text-light rounded">{{ log.get_status_display }}</td>
                                        {% elif log.status == "1" %}
                                            <td class="text-center bg-success text-light rounded">{{ log.get_status_display }}</td>
                                        {% else %}
                                            <td class="text-center bg-danger text-light rounded">{{ log.get_status_display }}</td>
                                        {% endif %}
                                    <td>{{ log.comment }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </article>
                </div>
            </div>
        </div>
    </div>

{% endblock %}