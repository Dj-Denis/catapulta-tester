{% extends 'base.html' %}
{% block content %}
    <div class="section section--hero">
        <div class="section__content">
            <div class="container-fludi container-wide">
                <div class="card">
                    <article class="card-body">
                        <table class="report_table table table-sm table-hover" id="report_table">
                            <thead>
                            <tr>
                                <th scope="col">Название</th>
                                <th scope="col">Создан</th>
                                <th scope="col">Скачать</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>

                            {% for report in report_list %}
                                <tr>
                                    <td>{{ report.name }}</td>
                                    <td>{{ report.create_at }}</td>
                                    <td><a class="btn btn-md btn-primary" href="{{ report.report_file.url }}" download>Скачать</a></td>
                                    <td><a class="text-dark" href={% url 'report_delete' report.pk %}><i class="fa fa-trash-o"
                                                                                 aria-hidden="true"></i></a></td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </article>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block script %}
    <script>
        var roomName = 'lobby';

        var table = $('#report_table').DataTable({
            "searching": false,
            "lengthChange": false,
            "pageLength": 100

        });

        var chatSocket = new WebSocket(
            'ws://' + window.location.host +
            '/ws/chat/' + roomName + '/');

        chatSocket.onmessage = function (e) {
            var data = JSON.parse(e.data);
            table.row.add([data['name'],
                moment(data['create_at']).locale('ru').format('D MMMM YYYY г. H:mm'),
                "<a download class=\"btn btn-md btn-primaryhref=\" + data['file'] + ">Скачать</a>",
            "<a class=\"text-dark\" href=\"report/delete/" + data['id'] + "\"><i class=\"fa fa-trash-o aria-hidden=\"true\"></i></a>"]).draw();
        };

        chatSocket.onclose = function (e) {
            console.error('Chat socket closed unexpectedly');
        };
    </script>
{% endblock %}